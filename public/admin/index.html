<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Admin</title><style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:16px;background:#0b0b0b;color:#eee}header{display:flex;gap:12px;align-items:center;margin-bottom:16px}select,button,input,textarea{background:#181818;color:#eee;border:1px solid #333;border-radius:8px;padding:8px;font-size:14px}table{width:100%;border-collapse:collapse;margin-top:12px}th,td{border:1px solid #222;padding:8px;vertical-align:top}th{background:#141414;text-align:left}.row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}.hidden{display:none}.badge{padding:2px 6px;border-radius:6px;background:#222;border:1px solid #333;font-size:12px}</style></head><body><header><h3 style="margin:0">Admin</h3><span class="badge" id="env">API: /api (auth required)</span><div class="row"><label>Admin Key <input id="adminkey" placeholder="x-admin-key" style="min-width:260px"></label><label>Table <select id="table"><option>projects</option><option>work_experience</option><option>tools</option><option>skills</option><option>gallery</option></select></label><button id="refresh">Refresh</button><button id="new">New</button></div></header><div id="status"></div><div id="form" class="hidden"></div><table id="grid"><thead></thead><tbody></tbody></table><script>const apiBase = "/api";const tableSel=document.getElementById("table");const gridT=document.getElementById("grid");const thead=gridT.querySelector("thead");const tbody=gridT.querySelector("tbody");const statusEl=document.getElementById("status");const formBox=document.getElementById("form");const keyInput=document.getElementById("adminkey");document.getElementById("refresh").onclick=load;document.getElementById("new").onclick=()=>openForm({});tableSel.onchange=load;function auth(){return { 'x-admin-key': keyInput.value }}async function load(){const t=tableSel.value;setStatus("Loading "+t+"...");const res=await fetch(apiBase+"/admin/"+t,{headers:auth()});const rows=await res.json();render(rows)}function setStatus(msg,ok){statusEl.textContent=msg;statusEl.style.color=ok?"#8ef":"#bbb"}function render(rows){thead.innerHTML="";tbody.innerHTML="";if(!rows||!rows.length){setStatus("No rows");return}const cols=Object.keys(rows[0]);const tr=document.createElement("tr");cols.forEach(c=>{const th=document.createElement("th");th.textContent=c;tr.appendChild(th)});const thA=document.createElement("th");thA.textContent="actions";tr.appendChild(thA);thead.appendChild(tr);rows.forEach(r=>{const tr=document.createElement("tr");cols.forEach(c=>{const td=document.createElement("td");td.textContent=(typeof r[c]==="object"?JSON.stringify(r[c]):r[c]??"");tr.appendChild(td)});const tdA=document.createElement("td");const eBtn=document.createElement("button");eBtn.textContent="Edit";eBtn.onclick=()=>openForm(r);const dBtn=document.createElement("button");dBtn.textContent="Delete";dBtn.onclick=()=>del(r.id);tdA.appendChild(eBtn);tdA.appendChild(dBtn);tr.appendChild(tdA);tbody.appendChild(tr)})}function openForm(row){formBox.classList.remove("hidden");const t=tableSel.value;formBox.innerHTML="";const form=document.createElement("div");form.className="row";Object.entries(row).forEach(([k,v])=>{if(["id","created_at","updated_at"].includes(k))return;const input=k.match(/description|full_description|metadata/)?document.createElement("textarea"):document.createElement("input");input.name=k;input.value=typeof v==="object"?JSON.stringify(v):v??"";input.placeholder=k;input.style.minWidth="220px";form.appendChild(input)});const save=document.createElement("button");save.textContent="Save";save.onclick=()=>saveRow(row.id);const upload=document.createElement("button");upload.textContent="Upload file to R2";upload.onclick=()=>uploadR2(t);const cancel=document.createElement("button");cancel.textContent="Cancel";cancel.onclick=()=>formBox.classList.add("hidden");formBox.appendChild(form);formBox.appendChild(save);formBox.appendChild(upload);formBox.appendChild(cancel)}async function saveRow(id){const t=tableSel.value;const inputs=[...formBox.querySelectorAll("input,textarea")];const body={};inputs.forEach(i=>{let val=i.value;if(val==="") return;try{ if(i.name==="tech_stack"||i.name==="metadata") val=JSON.parse(val)}catch(e){}body[i.name]=val});const method=id?"PUT":"POST";const url=id?apiBase+"/admin/"+t+"/"+id:apiBase+"/admin/"+t;const res=await fetch(url,{method,headers:{"Content-Type":"application/json",...auth()},body:JSON.stringify(body)});const out=await res.json();setStatus((id?"Updated ":"Created ")+out.id,true);formBox.classList.add("hidden");load()}async function del(id){const t=tableSel.value;if(!confirm("Delete #"+id+"?")) return;await fetch(apiBase+"/admin/"+t+"/"+id,{method:"DELETE",headers:auth()});setStatus("Deleted "+id,true);load()}async function uploadR2(t){const file=await pickFile();if(!file) return;const key=`${t}/${Date.now()}-${file.name}`;const pres=await fetch(apiBase+"/admin/r2/presign",{method:"POST",headers:{"Content-Type":"application/json",...auth()},body:JSON.stringify({key,contentType:file.type})});const {url,publicUrl}=await pres.json();await fetch(url,{method:"PUT",headers:{"Content-Type":file.type},body:file});setStatus("Uploaded "+file.name,true);const input=([...formBox.querySelectorAll("input[name='image_url'],input[name='featured_image_url']")][0]);if(input&&publicUrl){input.value=publicUrl}}async function pickFile(){return new Promise(resolve=>{const i=document.createElement("input");i.type="file";i.onchange=()=>resolve(i.files[0]);i.click()})}load();</script></body></html>